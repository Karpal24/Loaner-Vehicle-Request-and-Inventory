<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_script">
    <sys_script action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>true</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection>x_1399238_lva_vehicle_tracker</collection>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition table="x_1399238_lva_vehicle_tracker">vehicle_statusCHANGESTOsent_servicing^EQ<item display_value="Sent for Servicing" endquery="false" field="vehicle_status" goto="false" newquery="false" operator="CHANGESTO" or="false" value="sent_servicing"/>
            <item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/>
        </filter_condition>
        <is_rest>false</is_rest>
        <message/>
        <name>Tracker set to Sent to Servicing</name>
        <order>300</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {

	// Add your code here

	var gr = new GlideRecord('x_1399238_lva_vehicle_servicing_t');
	
	gr.addQuery('vehicle_tracker',current.sys_id+'');
	gr.addQuery('tracker_status','open');
	gr.query();
if(!gr.next()){
	
	var ngr = new GlideRecord('x_1399238_lva_vehicle_servicing_t');
	var nDate = new GlideDate();
	ngr.initialize();
    ngr.setValue('vehicle_tracker', current.sys_id);
	ngr.setValue('vehicle', current.vehicle);
	ngr.setValue('vehicle_status','in_service');
	ngr.setValue('data_send_for_servicing', current.date);
	ngr.setValue('ticket_status','open');
	ngr.insert();

}
	
})(current, previous);

/*

Creating servicing ticket

Create a variable for a new GlideRecord on the servicing table
Query the servicing table for the current sys_id of the record that is 
in the vehicle tracker field
Query the servicing table for records where the tracker status is open
Execute the query
Create a “if statement”: if no matching records are found from the previous 
query move on with the script: .next()
Now you will create a couple more variables
Create a variable for a new GlideRecord on the servicing table
Create a variable for a new GlideDate that will get the current date 
( this will be used to set the current date in the servicing ticket’s
 opening date)
Initialize the creation of a new record on the servicing table using the 
GlideRecord variable you created
Populate the required fields to create the new ticket per the stories 
requirement
Set the value of vehicle tracker to the current records sys_id
Set the value of vehicle to the current records vehicle value
Set the value of vehicle status to in service
Set the value of date sent for servicing to the current date
Set the value of ticket status to open
Insert the new record
*/]]></script>
        <sys_class_name>sys_script</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-08-29 23:05:30</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>4ad0658a83109210b807c1ffeeaad355</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>Tracker set to Sent to Servicing</sys_name>
        <sys_overrides/>
        <sys_package display_value="Loaner Vehicle Request and Inventory" source="x_1399238_lva">0e804ac483334e10b807c1ffeeaad3df</sys_package>
        <sys_policy/>
        <sys_scope display_value="Loaner Vehicle Request and Inventory">0e804ac483334e10b807c1ffeeaad3df</sys_scope>
        <sys_update_name>sys_script_4ad0658a83109210b807c1ffeeaad355</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-08-29 23:08:58</sys_updated_on>
        <template/>
        <when>before</when>
    </sys_script>
    <sys_translated_text action="delete_multiple" query="documentkey=4ad0658a83109210b807c1ffeeaad355"/>
</record_update>
