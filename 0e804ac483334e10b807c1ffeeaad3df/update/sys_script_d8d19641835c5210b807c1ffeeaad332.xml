<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_script">
    <sys_script action="INSERT_OR_UPDATE">
        <abort_action>false</abort_action>
        <access>package_private</access>
        <action_delete>false</action_delete>
        <action_insert>false</action_insert>
        <action_query>false</action_query>
        <action_update>true</action_update>
        <active>true</active>
        <add_message>false</add_message>
        <advanced>true</advanced>
        <change_fields>false</change_fields>
        <client_callable>false</client_callable>
        <collection>x_1399238_lva_vehicle_tracker</collection>
        <condition/>
        <description/>
        <execute_function>false</execute_function>
        <filter_condition table="x_1399238_lva_vehicle_tracker">vehicle_statusVALCHANGES^EQ<item display_value="-- None --" endquery="false" field="vehicle_status" goto="false" newquery="false" operator="VALCHANGES" or="false" value=""/>
            <item endquery="true" field="" goto="false" newquery="false" operator="=" or="false" value=""/>
        </filter_condition>
        <is_rest>false</is_rest>
        <message/>
        <name>Record to match state of  Vehicle Track</name>
        <order>200</order>
        <priority>100</priority>
        <rest_method/>
        <rest_method_text/>
        <rest_service/>
        <rest_service_text/>
        <rest_variables/>
        <role_conditions/>
        <script><![CDATA[(function executeRule(current, previous /*null when async*/) {

	// Add your code here
	var track;
	var gr = new GlideRecord('x_1399238_lva_lvr');//catalog table
	//var ga =new GlideRecord('x_1399238_lva_vehicle_tracker');
	
	//gr.query();

		//while(gr.next())
	//	{
			track = current.vehicle_status;
			gr.addQuery('sys_id',current.vehicle);
			gr.query();
			if (gr.next()){

			if(track=='pending_release'|| 
				track=='out_on_field' ||
				track=='returned_inspection'||
				track=='sent_servicing'){

				gr.setValue('status','unavailable');
			
				}
			else
			if(track=='returned_warehouse'){
				gr.setValue('status','available');
			}
			else
			if(track=='decommissioned'){
			gr.setValue('status','decommissioned');

			}
				gr.update();
		//	}

	//gr.clear();
	}

})(current, previous);

/*
BR 1: Update the vehicle catalog record status field

Create a variable for the current vehicle status field
Create a variable for a new GlideRecord on the loaner vehicle catalog table
Query that table for the sys_id or the current vehicle field
Execute the query
Iterate through the vehicle tracker table and if the “if statements” are true for each vehicle tracker status change the status on the loaner vehicle catalog table as stated in the story
If the vehicle status on the tracker table is pending release, out on field, returned for inspection, or sent for servicing then set the status field on the loaner vehicle catalog table to unavailable
If the vehicle status on the tracker table is returned to warehouse then set the status field on the loaner vehicle catalog table to available
If the vehicle status on the tracker table is decommissioned then set the status field on the loaner vehicle catalog table to decommissioned
Update the status field on the loaner vehicle
*/]]></script>
        <sys_class_name>sys_script</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-08-27 00:06:32</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>d8d19641835c5210b807c1ffeeaad332</sys_id>
        <sys_mod_count>53</sys_mod_count>
        <sys_name>Record to match state of  Vehicle Track</sys_name>
        <sys_overrides/>
        <sys_package display_value="Loaner Vehicle Request and Inventory" source="x_1399238_lva">0e804ac483334e10b807c1ffeeaad3df</sys_package>
        <sys_policy/>
        <sys_scope display_value="Loaner Vehicle Request and Inventory">0e804ac483334e10b807c1ffeeaad3df</sys_scope>
        <sys_update_name>sys_script_d8d19641835c5210b807c1ffeeaad332</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-08-29 23:42:18</sys_updated_on>
        <template/>
        <when>after</when>
    </sys_script>
    <sys_translated_text action="delete_multiple" query="documentkey=d8d19641835c5210b807c1ffeeaad332"/>
</record_update>
